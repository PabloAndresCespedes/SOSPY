<!DOCTYPE html>

<html>
    <head>
        <meta name="format-detection" content="telephone=no">
        <meta name="msapplication-tap-highlight" content="no">
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
        <meta charset="UTF-8">

        <link rel="stylesheet" type="text/css" href="css/bootstrap.css">
        <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css"> 
        <link rel="stylesheet" type="text/css" href="css/index.css">

        <link rel="stylesheet" type="text/css" href="css/font-awesome.min.css"/>

        <link rel="stylesheet" type="text/css" href="css/all.css">


        <link rel="stylesheet" type="text/css" href="css/vendor/font-awesome.min.css">
        <title>SOS PY</title>
        <script src="js/jquery-2.1.3.min.js"></script>
        <script type="text/javascript" src="cordova.js"></script>
        <script>
            var db = null;  
            var llama = null;

            document.addEventListener("deviceready", onDeviceReady, false);
            function onDeviceReady() {
                
                console.log("device is ready");
                db = window.sqlitePlugin.openDatabase({ name: "sospy.db", createFromLocation: 1 });       
                llama = window.plugins.CallNumber.callNumber(onSuccess, onError, number['NUMERO_BOMBERO'], true);

            }

            function llamarBombero(){
                db.transaction(BomberoCall, error);
            }

            function llamarPolicia(){
                db.transaction(PoliceCall, error);
            }

            function BomberoCall(tx){
                alert('llamaBomber');
            }
            function PoliceCall(tx){
                tx.executeSql("select T.NUMERO as 'NUMERO_POLICIA' from DEPENDENCIAS D inner join TELEFONOS T on(T.ID_DEPENDENCIAS = D.ID) where D.ID_ENTIDAD = ?", [1], function (tx, result) {
                    var nDatos = result.rows.length;
                    
                    if (nDatos > 0) {
                        var number = result.rows.item(0);
                        llama = window.plugins.CallNumber.callNumber(onSuccess, onError, number['NUMERO_POLICIA'], true);
                    }
                    else {
                        alert("no hay datos polic√≠a");
                    }
                });
            }
            function onSuccess(result) {
                console.log("Success:" + result);
            }

            /*FUNCION DE ERROR EN LA LLAMADA*/
            function onError(result) {
                console.log("Error:" + result);
            }
            
            function error(err) {
                alert("error =" + err.message);
            }

            //FUNCION PARA CERRAR
            var pageHistory = [];

            $(document).on("deviceready", onDeviceReady);


            function onDeviceReady(){
                $(document).on("pagecontainerload", onPageLoad);
                $(document).on("backbutton", onBackButton);
            }

            function onBackButton(e){
                e.preventDefault();
                pageHistory.pop();
                if(pageHistory.length==0){
                    navigator.app.exitApp();
                }
                else{
                    navigator.app.backHistory();
                }
            }

            function onPageLoad(e, ui){
                var pageId = ui.toPage.attr('id');
                if(pageId !== pageHistory[pageHistory.length]){
                    pageHistory.push(pageId);
                }    
            }
            
        </script>
    </head>
    <body>
       
        <div class="logo container-fluid">
            <img src="img/SOSPY.png" class="foto1 rounded mx-auto d-block" alt="Responsive image" align="left">
        </div>    
        <br><br><br><br><br>

        <div class="container-fluid" align="right">
            <div class="boton">
                    <a href="#"><img src="img/bombero.png" class="ic" onclick="llamarBombero();"> </a> 
            </div> 
        </div>

        <div class="container-fluid" align="left">  
            <div class="boton">
                    <a href="#"><img src="img/police.png" class="ic" onclick="llamarPolicia();"></a>   
            </div>
            <div id="datosPreferencias">

            </div>
        </div>


        <div class="navbar">
          <a href="index2.html"><i class="fa fa-fw fa-home"></i>Inicio</a> 
          <a href="index3.html"><i class="fa fa-fw fa-user"></i> Bomberos</a>  
          <a href="index4.html"><i class="fa fa-fw fa-user"></i> Policia</a>
          <a href="index5.html"><i class="fa fa-fw fa-envelope"></i> Contactos</a>
        </div>

        <script src="js/jquery-3.3.1.slim.min.js"></script>
        <script src="js/popper.min.js"></script>
        <script src="js/bootstrap.min.js"></script>
    </body>
</html>
